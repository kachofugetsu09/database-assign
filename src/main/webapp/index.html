<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户信息管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .container {
            max-width: 960px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1 class="mb-4">用户信息管理系统</h1>

    <!-- 创建用户表单 -->
    <div class="card mb-4">
        <div class="card-header">
            添加/更新用户
        </div>
        <div class="card-body">
            <form id="userForm">
                <div class="mb-3">
                    <label for="userId" class="form-label">用户ID</label>
                    <input type="number" class="form-control" id="userId" required>
                </div>
                <div class="mb-3">
                    <label for="userName" class="form-label">姓名</label>
                    <input type="text" class="form-control" id="userName" required>
                </div>
                <div class="mb-3">
                    <label for="userAge" class="form-label">年龄</label>
                    <input type="number" class="form-control" id="userAge" required>
                </div>
                <button type="button" class="btn btn-primary" id="saveUser">保存</button>
                <button type="button" class="btn btn-success" id="updateUser">更新</button>
                <button type="button" class="btn btn-danger" id="deleteUser">删除</button>
                <button type="button" class="btn btn-secondary" id="resetForm">重置</button>
            </form>
        </div>
    </div>

    <!-- 查询功能 -->
    <div class="card mb-4">
        <div class="card-header">
            查询用户
        </div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <button type="button" class="btn btn-info" id="fetchById">按ID查询</button>
                    <input type="number" class="form-control mt-2" id="queryId" placeholder="输入用户ID">
                </div>
                <div class="col-md-8">
                    <button type="button" class="btn btn-info" id="fetchByAgeRange">按年龄范围查询</button>
                    <div class="d-flex mt-2">
                        <input type="number" class="form-control me-2" id="minAge" placeholder="最小年龄">
                        <input type="number" class="form-control" id="maxAge" placeholder="最大年龄">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 用户列表 -->
    <div class="card">
        <div class="card-header">
            用户列表
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>姓名</th>
                        <th>年龄</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="userTableBody">
                    <!-- 用户数据将在这里动态加载 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // API基础URL
    const API_URL = '/database-assign/api/users';

    // DOM元素
    const userForm = document.getElementById('userForm');
    const userIdInput = document.getElementById('userId');
    const userNameInput = document.getElementById('userName');
    const userAgeInput = document.getElementById('userAge');
    const saveUserBtn = document.getElementById('saveUser');
    const updateUserBtn = document.getElementById('updateUser');
    const deleteUserBtn = document.getElementById('deleteUser');
    const resetFormBtn = document.getElementById('resetForm');
    const fetchByIdBtn = document.getElementById('fetchById');
    const queryIdInput = document.getElementById('queryId');
    const fetchByAgeRangeBtn = document.getElementById('fetchByAgeRange');
    const minAgeInput = document.getElementById('minAge');
    const maxAgeInput = document.getElementById('maxAge');
    const userTableBody = document.getElementById('userTableBody');

    // 保存用户
    saveUserBtn.addEventListener('click', async () => {
        try {
            const userData = {
                id: parseInt(userIdInput.value),
                name: userNameInput.value,
                age: parseInt(userAgeInput.value)
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            if (response.ok) {
                const result = await response.json();
                alert('用户创建成功!');
                resetForm();
                await fetchByAgeRange();
            } else {
                const error = await response.json();
                alert(`创建失败: ${error}`);
            }
        } catch (error) {
            alert(`发生错误: ${error.message}`);
        }
    });

    // 更新用户
    updateUserBtn.addEventListener('click', async () => {
        try {
            const id = parseInt(userIdInput.value);
            const userData = {
                name: userNameInput.value,
                age: parseInt(userAgeInput.value)
            };

            const response = await fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(userData)
            });

            if (response.ok) {
                const result = await response.json();
                alert('用户更新成功!');
                resetForm();
                await fetchByAgeRange();
            } else {
                const error = await response.json();
                alert(`更新失败: ${error}`);
            }
        } catch (error) {
            alert(`发生错误: ${error.message}`);
        }
    });

    // 删除用户
    deleteUserBtn.addEventListener('click', async () => {
        try {
            const id = parseInt(userIdInput.value);
            if (!id) {
                alert('请输入要删除的用户ID');
                return;
            }

            if (!confirm(`确定要删除ID为${id}的用户吗?`)) {
                return;
            }

            const response = await fetch(`${API_URL}/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert('用户删除成功!');
                resetForm();
                await fetchByAgeRange();
            } else {
                const error = await response.json();
                alert(`删除失败: ${error}`);
            }
        } catch (error) {
            alert(`发生错误: ${error.message}`);
        }
    });

    // 按ID查询
    fetchByIdBtn.addEventListener('click', async () => {
        try {
            const id = queryIdInput.value;
            if (!id) {
                alert('请输入用户ID');
                return;
            }

            const response = await fetch(`${API_URL}/${id}`);

            if (response.ok) {
                const user = await response.json();
                populateTable([user]);

                // 填充表单以便编辑
                userIdInput.value = user.id;
                userNameInput.value = user.name;
                userAgeInput.value = user.age;
            } else {
                const error = await response.json();
                alert(`查询失败: ${error}`);
            }
        } catch (error) {
            alert(`发生错误: ${error.message}`);
        }
    });

    // 按年龄范围查询
    async function fetchByAgeRange() {
        try {
            const minAge = minAgeInput.value || 0;
            const maxAge = maxAgeInput.value || 100;

            const response = await fetch(`${API_URL}?minAge=${minAge}&maxAge=${maxAge}`);

            if (response.ok) {
                const users = await response.json();
                populateTable(users);
            } else {
                const error = await response.json();
                alert(`查询失败: ${error}`);
            }
        } catch (error) {
            alert(`发生错误: ${error.message}`);
        }
    }

    fetchByAgeRangeBtn.addEventListener('click', fetchByAgeRange);

    // 重置表单
    function resetForm() {
        userIdInput.value = '';
        userNameInput.value = '';
        userAgeInput.value = '';
    }

    resetFormBtn.addEventListener('click', resetForm);

    // 填充用户表格
    function populateTable(users) {
        userTableBody.innerHTML = '';

        if (users.length === 0) {
            const row = document.createElement('tr');
            row.innerHTML = '<td colspan="4" class="text-center">没有找到用户</td>';
            userTableBody.appendChild(row);
            return;
        }

        users.forEach(user => {
            const row = document.createElement('tr');
            row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.age}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-user" data-id="${user.id}">编辑</button>
                        <button class="btn btn-sm btn-danger delete-user" data-id="${user.id}">删除</button>
                    </td>
                `;
            userTableBody.appendChild(row);
        });

        // 添加编辑和删除按钮事件
        document.querySelectorAll('.edit-user').forEach(btn => {
            btn.addEventListener('click', async () => {
                const id = btn.getAttribute('data-id');
                const response = await fetch(`${API_URL}/${id}`);
                if (response.ok) {
                    const user = await response.json();
                    userIdInput.value = user.id;
                    userNameInput.value = user.name;
                    userAgeInput.value = user.age;
                }
            });
        });

        document.querySelectorAll('.delete-user').forEach(btn => {
            btn.addEventListener('click', async () => {
                const id = btn.getAttribute('data-id');
                if (confirm(`确定要删除ID为${id}的用户吗?`)) {
                    const response = await fetch(`${API_URL}/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        alert('用户删除成功!');
                        await fetchByAgeRange();
                    } else {
                        const error = await response.json();
                        alert(`删除失败: ${error}`);
                    }
                }
            });
        });
    }

    // 页面加载时获取所有用户
    document.addEventListener('DOMContentLoaded', () => {
        // 默认查询10-30岁的用户
        minAgeInput.value = 10;
        maxAgeInput.value = 30;
        fetchByAgeRange();
    });
</script>
</body>
</html>
